services:
  tailscale:
    image: tailscale/tailscale:v1.80.3
    container_name: playwright-mcp-vnc-tailscale
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_EXTRA_ARGS=--hostname=playwright-mcp-vnc
    volumes:
      - ./data/tailscale:/var/lib/tailscale
    ports:
      - "6080:6080"
      - "8931:8931"
    deploy:
      resources:
        limits:
          memory: 128m
    logging:
      driver: json-file
      options:
        max-size: "5m"
        max-file: "2"

  playwright-mcp-vnc:
    image: ghcr.io/matthewdart/playwright-mcp-vnc:latest
    container_name: playwright-mcp-vnc
    restart: unless-stopped
    network_mode: service:tailscale
    depends_on:
      - tailscale
    shm_size: 2g
    environment:
      - SCREEN_WIDTH=1280
      - SCREEN_HEIGHT=720
      - SCREEN_DEPTH=24
    labels:
      mcp.enabled: "true"
      mcp.namespace: "playwright"
      mcp.transport: "http"
      mcp.description: "Browser automation via Playwright MCP with headed Chromium. Supports interactive authentication via noVNC on port 6080."
      # Playwright MCP uses /sse not /mcp
      mcp.url: "http://127.0.0.1:8931/sse"
    volumes:
      - playwright-data:/home/pwuser/.config/chromium
    deploy:
      resources:
        limits:
          memory: 2g
          cpus: "2.0"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  playwright-data:
